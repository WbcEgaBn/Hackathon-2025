<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Colorado Springs Location Search</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        #map {
            height: 500px;
            width: 100%;
            border-radius: 0.5rem;
        }
        .location-item {
            transition: all 0.3s ease;
        }
        .location-item:hover {
            transform: translateX(4px);
        }
        .radius-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            background-color: rgba(59, 130, 246, 0.1);
            color: rgb(59, 130, 246);
            font-size: 0.875rem;
            font-weight: 500;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100">
    <div id="root" class="min-h-screen py-8 px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <div class="mb-8">
                <h1 class="text-4xl font-bold text-slate-900 mb-2">üìç Location Explorer</h1>
                <p class="text-slate-600">Search locations in Colorado Springs and select areas of interest</p>
            </div>

            <!-- Main Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Left Panel - Controls and Map -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                        <!-- Search Input -->
                        <div class="mb-6">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">
                                Search Location
                            </label>
                            <input
                                id="searchInput"
                                type="text"
                                placeholder="Enter a location (e.g., Downtown, Garden of the Gods)"
                                class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                            />
                        </div>

                        <!-- Radius Selector -->
                        <div class="mb-6">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">
                                Search Radius
                            </label>
                            <div class="flex items-center gap-3">
                                <select id="radiusSelect" class="flex-1 px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="2">2 miles</option>
                                    <option value="5" selected>5 miles</option>
                                    <option value="10">10 miles</option>
                                    <option value="15">15 miles</option>
                                </select>
                                <span class="radius-badge" id="radiusBadge">5 mi</span>
                            </div>
                        </div>
                    </div>

                    <!-- Map -->
                    <div class="bg-white rounded-lg shadow-md overflow-hidden">
                        <div id="map"></div>
                    </div>
                </div>

                

                    <!-- Action Button -->
                    <button id="continueBtn" style="display:none;" class="w-full mt-6 px-4 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white font-semibold rounded-lg hover:shadow-lg transition transform hover:scale-105">
                        Continue with Areas
                    </button>
                </div>
            </div>

            <!-- Stats Footer -->
            <div class="mt-8 bg-white rounded-lg shadow-md p-6">
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                    <div class="text-center">
                        <p id="locCount" class="text-2xl font-bold text-blue-600">0</p>
                        <p class="text-sm text-slate-600">Locations in radius</p>
                    </div>
                    <div class="text-center">
                        <p id="selCount" class="text-2xl font-bold text-green-600">0</p>
                        <p class="text-sm text-slate-600">Areas selected</p>
                    </div>
                    <div class="text-center">
                        <p id="radCount" class="text-2xl font-bold text-purple-600">5</p>
                        <p class="text-sm text-slate-600">Mile radius</p>
                    </div>
                    <div class="text-center">
                        <p class="text-2xl font-bold text-orange-600">10</p>
                        <p class="text-sm text-slate-600">Total locations</p>
                    </div>
                </div>
            </div>

            <!-- Navigation Links -->
            <div class="mt-8 flex gap-4 justify-center flex-wrap">
                <a href="secondfile.html" class="px-6 py-3 bg-gray-600 text-white font-medium rounded-lg hover:bg-gray-700 transition">
                    ‚Üê Back to Interests
                </a>
                <a href="index.html" class="px-6 py-3 bg-gray-600 text-white font-medium rounded-lg hover:bg-gray-700 transition">
                    ‚Üê Back to Email
                </a>
                <a href="chatbot.html" class="px-6 py-3 bg-black text-white font-medium rounded-lg hover:bg-gray-800 transition">
                    ‚Üí Talk to AI Assistant
                </a>
            </div>

            <!-- Continue Button -->
            <div class="mt-8 text-center">
                <a 
                    href="location-map.html"
                    class="inline-block px-6 py-3 bg-blue-600 text-white font-medium rounded-xl transition-all duration-300 hover:bg-blue-700 active:scale-95 text-sm"
                >
                    ‚Üí Continue to Location Search
                </a>
            </div>
        </div>
    </div>

    <script>
        // Data
        const SAMPLE_LOCATIONS = [
            { id: 1, name: 'Downtown Colorado Springs', lat: 38.8355, lng: -104.8210, category: 'Downtown' },
            { id: 2, name: 'Old Colorado City', lat: 38.8484, lng: -104.8845, category: 'Historic' },
            { id: 3, name: 'Manitou Springs', lat: 38.8667, lng: -104.9039, category: 'Arts & Culture' },
            { id: 4, name: 'Garden of the Gods', lat: 38.8650, lng: -104.8853, category: 'Parks' },
            { id: 5, name: 'Cheyenne Mountain', lat: 38.7856, lng: -104.8334, category: 'Recreation' },
            { id: 6, name: 'Broadmoor Area', lat: 38.7775, lng: -104.8234, category: 'Upscale' },
            { id: 7, name: 'Air Force Academy', lat: 38.9956, lng: -104.8653, category: 'Military' },
            { id: 8, name: 'North Academy', lat: 39.0150, lng: -104.7853, category: 'Residential' },
            { id: 9, name: 'Southwest Colorado Springs', lat: 38.7567, lng: -104.9234, category: 'Residential' },
            { id: 10, name: 'East Colorado Springs', lat: 38.8234, lng: -104.7234, category: 'Commercial' },
        ];

        // State
        let selectedAreas = [];
        let currentRadius = 5;
        let searchLocation = '';
        let map;
        let markers = [];
        let circle = null;

        // Helper function - calculate distance
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 3959; // Earth's radius in miles
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Get search center coordinates
        function getSearchCenter() {
            let lat = 38.8355, lng = -104.8210;
            if (searchLocation.trim()) {
                const found = SAMPLE_LOCATIONS.find(loc => 
                    loc.name.toLowerCase().includes(searchLocation.toLowerCase())
                );
                if (found) {
                    lat = found.lat;
                    lng = found.lng;
                }
            }
            return { lat, lng };
        }

        // Get filtered locations
        function getFilteredLocations() {
            const center = getSearchCenter();
            return SAMPLE_LOCATIONS.filter(loc => {
                const distance = calculateDistance(center.lat, center.lng, loc.lat, loc.lng);
                return distance <= currentRadius;
            });
        }

        // Update map
        function updateMap() {
            const center = getSearchCenter();
            
            // Clear markers
            markers.forEach(m => map.removeLayer(m));
            markers = [];
            
            // Clear circle
            if (circle) map.removeLayer(circle);

            // Draw radius circle
            circle = L.circle([center.lat, center.lng], {
                radius: currentRadius * 1609.34,
                color: '#3b82f6',
                fillColor: '#3b82f6',
                fillOpacity: 0.1,
                weight: 2,
                dashArray: '5, 5',
            }).addTo(map);

            // Add center marker
            L.marker([center.lat, center.lng], {
                icon: L.icon({
                    iconUrl: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%233b82f6"%3E%3Cpath d="M12 0C7.03 0 3 4.03 3 9c0 5.25 9 15 9 15s9-9.75 9-15c0-4.97-4.03-9-9-9zm0 12c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z"/%3E%3C/svg%3E',
                    iconSize: [30, 30],
                    iconAnchor: [15, 30],
                })
            }).addTo(map);

            // Add location markers
            const filtered = getFilteredLocations();
            filtered.forEach(loc => {
                const distance = calculateDistance(center.lat, center.lng, loc.lat, loc.lng);
                const isInRadius = distance <= currentRadius;
                
                const marker = L.marker([loc.lat, loc.lng], {
                    icon: L.icon({
                        iconUrl: isInRadius 
                            ? 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2310b981"%3E%3Cpath d="M12 0C7.03 0 3 4.03 3 9c0 5.25 9 15 9 15s9-9.75 9-15c0-4.97-4.03-9-9-9zm0 12c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z"/%3E%3C/svg%3E'
                            : 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%236b7280"%3E%3Cpath d="M12 0C7.03 0 3 4.03 3 9c0 5.25 9 15 9 15s9-9.75 9-15c0-4.97-4.03-9-9-9zm0 12c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z"/%3E%3C/svg%3E',
                        iconSize: [25, 25],
                        iconAnchor: [12.5, 25],
                    })
                }).bindPopup(`<div class="p-2"><strong>${loc.name}</strong><br/><small>${distance.toFixed(1)} miles</small></div>`).addTo(map);
                markers.push(marker);
            });

            updateStats();
        }

        // Update locations list
        function updateLocationsList() {
            const filtered = getFilteredLocations();
            const list = document.getElementById('locationsList');
            list.innerHTML = '';

            if (filtered.length === 0) {
                list.innerHTML = '<div class="text-center py-6 text-slate-500"><p class="text-sm">No locations found in this radius</p></div>';
                return;
            }

            filtered.forEach(area => {
                const div = document.createElement('div');
                const isSelected = selectedAreas.includes(area.id);
                div.className = `location-item p-3 rounded-lg border-2 cursor-pointer ${
                    isSelected ? 'border-blue-500 bg-blue-50' : 'border-slate-200 hover:border-blue-300'
                } transition`;
                
                div.innerHTML = `
                    <div class="flex items-start gap-3">
                        <input type="checkbox" class="mt-1 w-4 h-4 text-blue-600 rounded" ${isSelected ? 'checked' : ''}>
                        <div class="flex-1 min-w-0">
                            <p class="font-semibold text-slate-900 text-sm truncate">${area.name}</p>
                            <p class="text-xs text-slate-500 mt-1">${area.category}</p>
                        </div>
                    </div>
                `;

                div.addEventListener('click', () => toggleArea(area.id));
                list.appendChild(div);
            });
        }

        // Toggle area selection
        function toggleArea(areaId) {
            const idx = selectedAreas.indexOf(areaId);
            if (idx > -1) {
                selectedAreas.splice(idx, 1);
            } else {
                selectedAreas.push(areaId);
            }
            updateUI();
        }

        // Update stats
        function updateStats() {
            const filtered = getFilteredLocations();
            document.getElementById('locCount').textContent = filtered.length;
            document.getElementById('selCount').textContent = selectedAreas.length;
            document.getElementById('radCount').textContent = currentRadius;
        }

        // Update all UI
        function updateUI() {
            updateLocationsList();
            updateMap();
            updateStats();

            // Show/hide buttons
            if (selectedAreas.length > 0) {
                document.getElementById('clearBtn').style.display = 'block';
                document.getElementById('continueBtn').style.display = 'block';
                document.getElementById('selectionInfo').textContent = `${selectedAreas.length} area${selectedAreas.length !== 1 ? 's' : ''} selected`;
            } else {
                document.getElementById('clearBtn').style.display = 'none';
                document.getElementById('continueBtn').style.display = 'none';
                document.getElementById('selectionInfo').textContent = 'Select locations to get started';
            }
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('input', (e) => {
            searchLocation = e.target.value;
            updateUI();
        });

        document.getElementById('radiusSelect').addEventListener('change', (e) => {
            currentRadius = parseInt(e.target.value);
            document.getElementById('radiusBadge').textContent = currentRadius + ' mi';
            updateUI();
        });

        document.getElementById('clearBtn').addEventListener('click', () => {
            selectedAreas = [];
            document.getElementById('searchInput').value = '';
            searchLocation = '';
            document.getElementById('radiusSelect').value = 5;
            currentRadius = 5;
            document.getElementById('radiusBadge').textContent = '5 mi';
            updateUI();
        });

        document.getElementById('continueBtn').addEventListener('click', () => {
            alert(`You selected ${selectedAreas.length} area(s)!`);
        });

        // Initialize
        window.addEventListener('load', () => {
            map = L.map('map').setView([38.8355, -104.8210], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 19,
            }).addTo(map);
            
            updateUI();
        });
    </script>
</body>
</html>
